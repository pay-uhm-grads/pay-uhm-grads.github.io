<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      // Load Dependancies
      google.charts.load('current', {
        'packages': ['table','corechart', 'bar', 'controls'],
      });

      // Calling the Functions
      google.charts.setOnLoadCallback(initialize_the_plot);
      google.charts.setOnLoadCallback(initialize_overall_hist);
      google.charts.setOnLoadCallback(initialize_pay_percent);
      google.charts.setOnLoadCallback(initialize_data_table);

      // Load The data to be used in the Main Plot
      function initialize_the_plot() {
        var the_plot_query = new google.visualization.Query(
          'https://spreadsheets.google.com/tq?key=1Ms3ha5UALbaC-ArBPefzXjM3rlQnviNpPmc_1T_RoT4&headers=1');

        the_plot_query.send(make_the_plot);
      }

      // Load the data that has the total count of pay
      function initialize_overall_hist() {
        var overall_hist_query = new google.visualization.Query(
          'https://spreadsheets.google.com/tq?key=1TsSzYte5BAFWg94ZOmVh0xqKbm-ofNWtZxw8MWQTm_o&headers=1');

        overall_hist_query.send(make_overall_hist);
      }

      // Load the data that has the department breakdown
      function initialize_pay_percent() {
        var overall_pay_percent = new google.visualization.Query(
          'https://spreadsheets.google.com/tq?key=1hYSaDO9c_VMS2Is_1VpoZbBWp1HK_wFMQf-M4GHAWuY&headers=1');

        overall_pay_percent.send(make_pay_percent);
      }

      // Load the data that has the nice table
      function initialize_data_table() {
        var overall_data_table = new google.visualization.Query(
          'https://spreadsheets.google.com/tq?key=1YarYCKDv2yjVppOXP-f29iC7a5H1kF8kcCaoplJBPyQ&headers=1');

        overall_data_table.send(make_data_table);
      }


      // Make The PLOT
      function make_the_plot(response) {
        // In case the URL doesn't work
        if (response.isError()) {
          alert('Error in pivot query');
        }

        // Get the data from the URL
        var pivotData = response.getDataTable();

        // The control that filters the plot
        var sectionChooser = new google.visualization.ControlWrapper({
          'controlType': 'CategoryFilter',
          'containerId': 'the_filter_div',
          'options': {
            'filterColumnIndex': 0,
            'ui': {
              'labelStacking': 'vertical',
              'label': '',
              'allowTyping': true,
              'allowMultiple': false,
              'chartArea': {height: '200px'}
            }
          },
          'state': {'selectedValues': ['SCHOOL OF LIFE SCIENCES']}
        });

        // Function just to get a array of ascending ints...
        function range(start, end) {
          return Array(end - start + 1).fill().map((_, idx) => start + idx)
        }
        var result = range(1, 120);
        //result.unshift(0);

        // This is the chart AKA THE PLOT
        var the_plot = new google.visualization.ChartWrapper({
          'chartType': 'ColumnChart',
          'containerId': 'the_plot_div',
          'options': {
            'legend': { position: 'none' },
            'title': 'Histogram of GA Base Salary of SCHOOL OF LIFE SCIENCES',
            'chartArea': {width: '75%', height: '75%', top: '5%'},
            'isStacked': true,
            bar: {groupWidth: "69%"},
            hAxis: {ticks: [18930, 19686, 20472, 21288, 22140, 23028, 23952, 24912, 25908, 26946, 28026, 29148, 30312, 31524, 32784, 34098, 35460],
            slantedText: true, slantedTextAngle:90, format: '$##,###', title: 'base salary',
            minValue: 18500, maxValue: 36000},
            vAxis: {format: '####', title: 'Number of GAs'}
          },
          'view': {'columns': result}
        });

        // create "statechange" event listeners for the CategoryFilters (this is for custom title)
        google.visualization.events.addListener(sectionChooser, 'statechange', changeTitle);

        // function to change title
        function changeTitle () {
          var department = sectionChooser.getState().selectedValues[0];
          let pre_title = "Histogram of GA Base Salary of ";
          the_plot.setOption('title', pre_title.concat(department));
          the_plot.draw();
        }

        // Create a dashboard to store chart and control
        var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div'));

        // bind the filter to the plot
        dashboard.bind(sectionChooser, the_plot);

        // Draw the dashboard
        dashboard.draw(pivotData);

      }

      // Make overall histogram
      function make_overall_hist(response) {
        // In case the URL doesn't work
        if (response.isError()) {
          alert('Error in pivot query');
        }

        // Get the data from the URL
        var overallData = response.getDataTable();

        // set bar_options
        var bar_options = {
          legend: { position: 'none' },
          isStacked: false,
          width: '100%',
          height: '100%',
          bar: {groupWidth: "69%"},
          chartArea: {width: '75%', height: '75%', top: '3%'},
          hAxis: {ticks: [18930, 19686, 20472, 21288, 22140, 23028, 23952, 24912, 25908, 26946, 28026, 29148, 30312, 31524, 32784, 34098, 35460],
          slantedText: true, slantedTextAngle:90, format: '$##,###', title: 'base salary',
          minValue: 18500, maxValue: 36000},
          vAxis: {format: '####', title: 'Number of GAs'}
        };

        // make the bar plot
        var overall_hist = new google.visualization.ColumnChart(document.getElementById("overall_hist_div"));

        // Draw the chart
        overall_hist.draw(overallData, bar_options);
      }


      // Make overall histogram
      function make_pay_percent(response) {
        // In case the URL doesn't work
        if (response.isError()) {
          alert('Error in pivot query');
        }

        // Get the data from the URL
        var breakdownData = response.getDataTable();

        // set bar_options
        var bar_options = {
          legend: { position: 'none' },
          isStacked: 'percent',
          width: '100%',
          height: '100%',
          bar: {groupWidth: "69%"},
          chartArea: {width: '75%', height: '75%', top: '3%'},
          hAxis: {ticks: [18930, 19686, 20472, 21288, 22140, 23028, 23952, 24912, 25908, 26946, 28026, 29148, 30312, 31524, 32784, 34098, 35460],
          slantedText: true, slantedTextAngle:90, format: '$##,###', title: 'base salary',
          minValue: 18500, maxValue: 36000},
          vAxis: {title: 'Percentage'}
        };

        // make the bar plot
        var pay_percent = new google.visualization.ColumnChart(document.getElementById("pay_percent_div"));

        // Draw the chart
        pay_percent.draw(breakdownData, bar_options);
      }

      // Make nice data table
      function make_data_table(response) {
        // In case the URL doesn't work
        if (response.isError()) {
          alert('Error in pivot query');
        }

        // Get the data from the URL
        var niceData = response.getDataTable();

        // make a table with the data we just loaded
        var full_table = new google.visualization.Table(
            document.getElementById('full_table_div'));

        // Draw the table
        full_table.draw(niceData, {showRowNumber: false, width: '100%', height: '100%'});

      }


    </script>
  </head>
  <style>
    th, td {
      border: 5px solid black;
      border-style: inset;
      border-radius: 20px;
    }
    .goog-menu-vertical {
      max-height: 600px;
      max-width: 400px;
      text-align: left;
      overflow-y: auto;
    }
  </style>
  <body>
    <br>
    <h1 align="center">The UHM: GA Base Salary Plots</h1>
    <p align="center" style="font-size: 20px">Below are some plots made with the publically avaiable Graduate Assistance Compensation data from 2022!</p>
    <p align="center"><a href="https://form.jotform.com/220947446792063"style="font-size: 28px"><b>SIGN THE PETITION!!</b></a></p>

    <div id="dashboard_div" >
      <table align="center" cellpadding="0" style="width: 100%;">
        <tr valign="top">
          <td style="width: 80%;" align="center">
            <br>
            <p style="font-size: 20px"><b>Histogram of GA Pay by Department</b><br>
              Use the Department Selector to the right!</p>
            <div id="the_plot_div" style="align: center; height: 600px;"></div>
          </td>
          <td style="width: 20%;" align="center">
            <br>
            <p style="font-size: 20px"><b>Department Selector (Type Supported!)</b></p>
            <div id="the_filter_div" style="align: center; height: 600px;"></div>
          </td>
        </tr>
      </table>
    </div>

    <table align="center" cellpadding="0" style="width: 100%;">
      <tr valign="top">
        <td style="width: 50%;" align="center">
          <br>
          <p style="font-size: 20px"><b>Overall Histogram of GA Pay</b>
          <div id="overall_hist_div" style="align: center; height: 600px;"></div>
        </td>
        <td style="width: 50%;" align="center">
          <br>
          <p style="font-size: 20px"><b>Percent Breakdown of GA Pay by Department</b>
          <div id="pay_percent_div" style="align: center; height: 600px;"></div>
        </td>
      </tr>
      <tr>
        <td colSpan=2 align="center" style="height: 500px">
          <br>
          <p style="font-size: 20px"><b>Data of the GA Pay</b>
          <div id="full_table_div" style="align: center; width: 1000px; height: 400px;"></div>
        </td>
      </tr>
    </table>
    <br>
    <br>



  </body>
</html>
